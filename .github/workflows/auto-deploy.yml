name: ğŸš€ Auto Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
    types: [ closed ]

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    if: github.event_name == 'push' || (github.event_name == 'pull_request' && github.event.pull_request.merged == true)
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: homepage/package-lock.json

    - name: ğŸ“¦ Install Dependencies
      run: |
        cd homepage
        npm ci

    - name: ğŸ” Run Tests
      run: |
        cd homepage
        npm test -- --coverage --watchAll=false

    - name: ğŸ—ï¸ Build React App
      run: |
        cd homepage
        npm run build

    - name: ğŸ“‹ Setup Pages
      uses: actions/configure-pages@v4

    - name: ğŸ“¤ Upload Build Artifacts
      uses: actions/upload-pages-artifact@v3
      with:
        path: homepage/build

    - name: ğŸš€ Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4

    - name: ğŸ“Š Deployment Summary
      run: |
        echo "ğŸ‰ Deployment completed successfully!"
        echo "ğŸ“… Deployed at: $(date)"
        echo "ğŸŒ Live URL: https://markusvankempen-ai.github.io/mvkdeveloper/"
        echo "ğŸ“ Commit: ${{ github.sha }}"
        echo "ğŸ‘¤ Author: ${{ github.actor }}"

  notify-status:
    runs-on: ubuntu-latest
    needs: build-and-deploy
    if: always()
    
    steps:
    - name: ğŸ“¢ Deployment Status
      run: |
        if [ "${{ needs.build-and-deploy.result }}" == "success" ]; then
          echo "âœ… AUTO-DEPLOYMENT SUCCESSFUL"
          echo "ğŸŒ Your site is live at: https://markusvankempen-ai.github.io/mvkdeveloper/"
          echo "ğŸ“Š All automated processes completed successfully"
        else
          echo "âŒ AUTO-DEPLOYMENT FAILED"
          echo "ğŸ” Please check the build logs for details"
          echo "ğŸ› ï¸ Manual intervention may be required"
        fi 